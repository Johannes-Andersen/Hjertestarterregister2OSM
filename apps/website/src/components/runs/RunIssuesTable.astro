---
import type { SyncRunIssueListItem } from "@repo/sync-store";
import { issueTypeLabels } from "../../utils/constants";
import { getOsmIssueLink } from "../../utils/getOsmIssueLink";

interface Props {
  issues: SyncRunIssueListItem[];
  emptyText?: string;
}

const { issues, emptyText = "No issues were recorded for this run." } =
  Astro.props;
---

{issues.length ? (
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Type</th>
            <th>Severity</th>
            <th>Message</th>
            <th>OSM</th>
          </tr>
        </thead>
        <tbody>
          {issues.map((issue) => {
            const osmIssueLink = getOsmIssueLink(issue);

            return (
              <tr>
                <td>
                  <span>{issueTypeLabels[issue.issueType] ?? issue.issueType}</span>
                  <code>{issue.issueType}</code>
                </td>
                <td>{issue.severity}</td>
                <td>{issue.message}</td>
                <td>
                  {osmIssueLink ? (
                    <a href={osmIssueLink.href} target="_blank" rel="noreferrer">
                      {osmIssueLink.label}
                    </a>
                  ) : (
                    "-"
                  )}
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  ) : (
    <p class="empty">{emptyText}</p>
  )}

<style>
.table-wrap {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th,
td {
  padding: 0.6rem;
  font-size: 0.9rem;
  text-align: left;
  white-space: nowrap;
  border-bottom: 1px solid #dbe3df;
}

td code {
  margin-left: 0.4rem;
  font-size: 0.75rem;
  color: var(--ink-subtle);
}

.empty {
  margin: 0;
  color: var(--ink-subtle);
}
</style>
